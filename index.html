<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <meta charset="UTF-8" />
  <title>Rank Score Tool</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">

    <!-- Main Menu -->
    <div id="mainMenu" class="panel main-menu">
      <h1 class="menu-heading">What you want to do today?</h1>
      <div class="menu-grid">
        <div class="menu-tile" onclick="showPanel('calculator')">
          <div class="menu-icon"><i class="fas fa-chart-line"></i></div>
          <div class="menu-title">Rank Calculate</div>
        </div>
        <div class="menu-tile excel" onclick="showPanel('updateExcel')">
          <div class="menu-icon"><i class="fas fa-file-excel"></i></div>
          <div class="menu-title">Update Excel</div>
        </div>
        <div class="menu-tile facebook" onclick="window.open('https://www.facebook.com/newstarxiangqi', '_blank')">
          <div class="menu-icon"><i class="fab fa-facebook-f"></i></div>
          <div class="menu-title">Visit us on Facebook</div>
        </div>
        <div class="menu-tile coming-soon">
          <div class="menu-icon">üöß</div>
          <div class="menu-title">Many more coming...</div>
        </div>
      </div>
    </div>

    <!-- Panel 1: Rank Score Calculator -->
    <div id="calculator" class="panel styled-panel" style="display: none;">
      <div class="content-box">
        <div class="header-row">
          <button onclick="showPanel('mainMenu')">‚¨Ö Back</button>
          <button class="user-guide" onclick="window.open('guide.html', '_blank')">üìò User Guide</button>
        </div>

        <h1>Rank Score Calculator</h1>

        <label>Import Text File:</label>
        <input type="file" id="importFile" accept=".txt,.csv" />

        <label>Insert Output File Name:</label>
        <input type="text" id="fileName" placeholder="filename" />

        <label>Round:</label>
        <input type="number" id="rounds" min="1" value="4" />

        <label>Mark:</label>
        <select id="markPerRound">
          <option value="1">1</option>
          <option value="2" selected>2</option>
        </select>

        <div class="actions">
          <button onclick="calculate()">Calculate</button>
          <button onclick="clearForm()">Clear</button>
        </div>

        <div id="resultMsg"></div>
      </div>
    </div>

    <!-- Panel 2: Update Excel Tool -->
    <div id="updateExcel" class="panel styled-panel" style="display: none;">
      <div class="content-box">
        <button onclick="showPanel('mainMenu')">‚¨Ö Back</button>
        <h1>Update Excel Tool</h1>
        <label>Upload Original Excel File:</label>
        <input type="file" id="excelFile" accept=".xlsx, .xls" />
        <label>Upload Rank Update Text File (from calculator):</label>
        <input type="file" id="rankUpdateFile" accept=".txt" />
        <button onclick="processRankUpdate()">Update and Download Excel</button>
        <hr />
        <label>‚úÖ Successfully Updated:</label>
        <textarea id="successList" rows="6" readonly style="width:100%; background:#e8f5e9; border: 1px solid #c8e6c9;"></textarea>
        <label>‚ùå Unmatched Entries:</label>
        <textarea id="failList" rows="6" readonly style="width:100%; background:#ffebee; border: 1px solid #ffcdd2;"></textarea>
      </div>
    </div>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="app.js"></script>
  <script src="updateExcel.js"></script>

  <script>
    function showPanel(panelId) {
      document.querySelectorAll('.panel').forEach(p => p.style.display = 'none');
      document.getElementById(panelId).style.display = 'block';
    }

    function alertKValues() {
      if (!players.length) {
        alert("No players loaded. Please upload a .txt file in Calculator tab first.");
        return;
      }
      players.forEach(p => alert(`Player: ${p[0]} | K: ${p[2]}`));
    }
  </script>
</body>
</html>
